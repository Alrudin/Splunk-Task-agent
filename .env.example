# AI-Assisted Splunk TA Generator - Environment Configuration
# Copy this file to .env and update values for your environment

# =============================================================================
# Database Configuration
# =============================================================================
DATABASE_URL=postgresql://postgres:postgres123@localhost:5432/splunk_ta_generator
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10
DATABASE_ECHO=false  # Set to true for SQL query logging (development only)

# =============================================================================
# Redis Configuration (Celery Broker)
# =============================================================================
REDIS_URL=redis://localhost:6379/0
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/1
CELERY_TASK_TIME_LIMIT=3600  # Task timeout in seconds
CELERY_WORKER_CONCURRENCY=4

# =============================================================================
# MinIO/S3 Object Storage Configuration
# =============================================================================
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET_SAMPLES=log-samples
MINIO_BUCKET_TAS=ta-artifacts
MINIO_BUCKET_DEBUG=debug-bundles
MINIO_BUCKET_KNOWLEDGE=knowledge-documents  # Bucket for uploaded knowledge documents (PDFs, Markdown, TA archives)
MINIO_USE_SSL=false
MINIO_REGION=us-east-1

# =============================================================================
# Pinecone Vector Database Configuration
# =============================================================================
# API Configuration
PINECONE_API_KEY=your-pinecone-api-key
# PINECONE_ENVIRONMENT=  # Optional, only for legacy (non-serverless) indexes; leave empty for serverless
PINECONE_CLOUD=aws  # Cloud provider for serverless (aws, gcp, azure)
PINECONE_REGION=us-east-1  # Region for serverless deployment

# Index Configuration
# Three-index strategy:
# - splunk-docs-index: Splunk Platform documentation for props.conf, transforms.conf, CIM
# - ta-examples-index: Previously developed TAs for similar log sources
# - sample-logs-index: Historical log samples (if SAMPLE_RETENTION_ENABLED=true)
PINECONE_INDEX_DOCS=splunk-docs-index
PINECONE_INDEX_TAS=ta-examples-index
PINECONE_INDEX_SAMPLES=sample-logs-index
PINECONE_DIMENSION=768  # Embedding dimension (768 for all-mpnet-base-v2)
PINECONE_METRIC=cosine  # Distance metric for similarity (cosine, euclidean, dotproduct)

# Embedding Model Configuration
# all-mpnet-base-v2: High-quality embeddings (768-dim) - RECOMMENDED for technical docs
# Alternative models:
# - all-MiniLM-L6-v2: Faster, smaller (384-dim) but lower quality
# - multi-qa-mpnet-base-dot-v1: Optimized for question-answering (768-dim)
EMBEDDING_MODEL_NAME=sentence-transformers/all-mpnet-base-v2
EMBEDDING_BATCH_SIZE=32  # Batch size for encoding (higher = faster but more memory)
EMBEDDING_NORMALIZE=true  # Normalize embeddings to unit vectors (recommended for cosine)

# Chunking Configuration
# Technical documentation chunks work best at 250-350 words
# Overlap ensures context continuity across chunk boundaries
CHUNK_SIZE_WORDS=300  # Words per document chunk
CHUNK_OVERLAP_WORDS=50  # Overlap between consecutive chunks
MAX_CHUNKS_PER_DOCUMENT=100  # Limit chunks to prevent excessive fragmentation

# Query Configuration
PINECONE_TOP_K=10  # Default number of results to return
PINECONE_QUERY_TIMEOUT=10  # Query timeout in seconds

# =============================================================================
# Ollama LLM Configuration
# =============================================================================
OLLAMA_HOST=localhost
OLLAMA_PORT=11434
OLLAMA_MODEL=llama2  # Model to use for TA generation (e.g., llama2, codellama, mistral)
OLLAMA_TIMEOUT=300    # Request timeout in seconds
OLLAMA_TEMPERATURE=0.7  # Temperature for generation (0.0-2.0, lower = more deterministic)
OLLAMA_MAX_TOKENS=4096  # Maximum tokens for LLM responses
OLLAMA_USE_SSL=false  # Use HTTPS for Ollama connection

# =============================================================================
# Authentication & Security
# =============================================================================
JWT_SECRET_KEY=your-secret-key-change-in-production-use-openssl-rand-hex-32
JWT_ALGORITHM=HS256
JWT_EXPIRATION_MINUTES=60
JWT_REFRESH_EXPIRATION_DAYS=7

# Authentication Providers
SAML_ENABLED=false
SAML_METADATA_URL=
SAML_ENTITY_ID=
SAML_LOGIN_URL=  # SP-initiated login URL (e.g., https://your-app.com/api/v1/auth/saml/login)

OAUTH_ENABLED=false
OAUTH_CLIENT_ID=
OAUTH_CLIENT_SECRET=
OAUTH_AUTHORIZE_URL=
OAUTH_TOKEN_URL=
OAUTH_USER_INFO_URL=

OIDC_ENABLED=false
OIDC_CLIENT_ID=
OIDC_CLIENT_SECRET=
OIDC_DISCOVERY_URL=
OIDC_AUTHORIZE_URL=  # Authorization endpoint (e.g., https://provider.com/oauth2/authorize)

LOCAL_AUTH_ENABLED=true  # Enable local username/password authentication

# =============================================================================
# System Configuration
# =============================================================================
SAMPLE_RETENTION_ENABLED=true  # Whether to retain uploaded log samples
SAMPLE_RETENTION_DAYS=90       # How long to keep samples
MAX_PARALLEL_VALIDATIONS=3     # Maximum concurrent Splunk validation containers
MAX_SAMPLE_SIZE_MB=500         # Maximum upload size for log samples
ALLOWED_WEB_DOMAINS=splunk.com,splunkbase.splunk.com,github.com
BLOCKED_WEB_DOMAINS=  # Comma-separated list of blocked domains (takes precedence over allowed)

# =============================================================================
# Logging Configuration
# =============================================================================
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json or text
ENABLE_AUDIT_LOGGING=true
AUDIT_LOG_RETENTION_DAYS=365
ENABLE_DEBUG_LOGGING=false
DEBUG_LOG_FILE=/var/log/splunk-ta-generator/debug.log

# =============================================================================
# Application Configuration
# =============================================================================
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000
BACKEND_WORKERS=4  # Number of Uvicorn workers
FRONTEND_URL=http://localhost:5173
CORS_ORIGINS=http://localhost:5173,http://localhost:3000
API_VERSION=v1
APP_NAME=Splunk TA Generator
APP_VERSION=0.1.0

# =============================================================================
# Splunk Sandbox Configuration
# =============================================================================
# Docker image for ephemeral Splunk containers used in validation
SPLUNK_IMAGE=splunk/splunk:9.1.0
# Timeout for Splunk container startup (seconds)
SPLUNK_STARTUP_TIMEOUT=300
# Admin password for Splunk sandbox containers (change in production!)
SPLUNK_ADMIN_PASSWORD=admin123
# Port range for Splunk management API (each validation gets a unique port)
SPLUNK_MANAGEMENT_PORT_RANGE_START=18089
SPLUNK_MANAGEMENT_PORT_RANGE_END=18189
# Docker network for container communication
DOCKER_NETWORK=splunk-ta-network

# =============================================================================
# Validation Configuration
# =============================================================================
# Maximum number of concurrent validation runs (limited by system resources)
MAX_PARALLEL_VALIDATIONS=3
# Overall validation timeout in seconds (30 minutes default)
VALIDATION_TIMEOUT=1800
# Delay before retrying when concurrency limit is reached (seconds)
VALIDATION_RETRY_DELAY=60
# Index name used for validation tests in Splunk sandbox
VALIDATION_INDEX_NAME=ta_validation_test
# Minimum field extraction coverage required for PASSED status (0.0-1.0)
VALIDATION_FIELD_COVERAGE_THRESHOLD=0.7

# Legacy settings (kept for backwards compatibility)
SPLUNK_HTTP_PORT=8000
SPLUNK_MANAGEMENT_PORT=8089
KUBERNETES_NAMESPACE=splunk-validation  # For K8s deployments

# =============================================================================
# Email/Notification Configuration
# =============================================================================
SMTP_ENABLED=false
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=notifications@example.com
SMTP_PASSWORD=
SMTP_FROM=noreply@example.com
SMTP_USE_TLS=true
NOTIFICATION_ENABLED=true

# =============================================================================
# Feature Flags
# =============================================================================
FEATURE_AUTO_APPROVE=false  # Auto-approve requests (development only)
FEATURE_MANUAL_OVERRIDE=true
FEATURE_DEBUG_BUNDLES=true
FEATURE_KNOWLEDGE_MANAGEMENT=true
FEATURE_METRICS_DASHBOARD=true

# =============================================================================
# Performance Tuning
# =============================================================================
REQUEST_TIMEOUT=60  # API request timeout in seconds
UPLOAD_CHUNK_SIZE=1048576  # 1MB chunks for file uploads
MAX_CONTENT_LENGTH=524288000  # 500MB max request size